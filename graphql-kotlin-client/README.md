# GraphQL Kotlin Client
[![Maven Central](https://img.shields.io/maven-central/v/com.expediagroup/graphql-kotlin-client.svg?label=Maven%20Central)](https://search.maven.org/search?q=g:%22com.expediagroup%22%20AND%20a:%22graphql-kotlin-client%22)
[![Javadocs](https://img.shields.io/maven-central/v/com.expediagroup/graphql-kotlin-client.svg?label=javadoc&colorB=brightgreen)](https://www.javadoc.io/doc/com.expediagroup/graphql-kotlin-client)

A lightweight, typesafe GraphQL HTTP client.

NOTE: While you can use the GraphQL client directly by manually creating your corresponding data model, the most common
mode of operation should be using a Gradle or Maven plugin and running the resulting auto-generated code.

## Features

* Automatic generation of type-safe Kotlin models
* Supports queries and mutations
* Custom scalar support
* Native support for coroutines

## Install it

Using a JVM dependency manager, link `graphql-kotlin-client` to your project.

With Maven:

```xml
<dependency>
  <groupId>com.expediagroup</groupId>
  <artifactId>graphql-kotlin-federation</artifactId>
  <version>${latestVersion}</version>
</dependency>
```

With Gradle (example using kts):

```kotlin
compile("com.expediagroup:graphql-kotlin-client:$latestVersion")
```

## Use it

### Download Schema

Before we can auto-generate the data model for our GraphQL queries we first need to obtain a copy of a corresponding
GraphQL schema. Do this by running one of the tasks supplied by the GraphQL Kotlin Gradle plugin through your
CLI:

```bash
./gradlew introspectSchema --endpoint="http://localhost:8080/sdl"
```

This runs an introspection query against the target GraphQL server and saves the resulting schema in the `schema.graphql` file
under the build directory. GraphQL schemas can change over time so you should configure this task to run
as part of your build/release process.

```kotlin
val introspectSchema by tasks.getting(IntrospectSchemaTask::class) {
    endpoint.set("http://localhost:8080/graphql")
}
```

### Write Queries

When creating your GraphQL queries make sure to always specify an operation name, and name the files accordingly. Each one
of your query files will result in generation of a Kotlin file with a class matching your operation name that contains
all your data classes. For example, given `MyAwesomeGraphQLQuery.graphql` with `myAwesomeQuery` as the operation name, GraphQL Kotlin
plugins will generate a corresponding `MyAwesomeGraphQLQuery.kt` file with a `MyAwesomeQuery` class under the configured package.

Please refer to our [documentation](https://expediagroup.github.io/graphql-kotlin) for additional details and considerations
while writing your GraphQL queries.

### Generate Client

GraphQL Kotlin build plugins will auto-generate your data classes based on your queries and the underlying GraphQL schema.
In order to generate your client you will need to specify the target package name, schema file, and queries. If the queries parameter
is omitted it will default to using `*.graphql` files under your resources directory.

```kotlin
val generateClient by tasks.getting(GenerateClientTask::class) {
    packageName.set("com.expediagroup.graphql.generated")
    // use schema file generated by the introspection task
    schemaFile.set(introspectSchema.outputFile)
    // make sure to run client generation after introspection task
    dependsOn("introspectSchema")
}
```

Additional information about Gradle and Maven plugins as well as their respective tasks/monos can be found in our
[documentation](https://expediagroup.github.io/graphql-kotlin).

### Execute Queries

Your auto generated classes accept an instance of `GraphQLClient` which requires the target URL to be specified. `GraphQLClient`
uses the Ktor HTTP client to execute the underlying queries and you can specify different engines (defaults to CIO) and
HTTP client features. Please refer to [Ktor HTTP client documentation](https://ktor.io/clients/index.html) for additional
details.

```kotlin
val client = GraphQLClient(url = URL("http://localhost:8080/graphql"))
val query = MyAwesomeQuery(client)
val result = query.myAwesomeQuery()
```

The result of your query is a type safe object that corresponds to your GraphQL query.

Additional information about Gradle and Maven plugins as well as their respective tasks/monos can be found in our
[documentation](https://expediagroup.github.io/graphql-kotlin).

## Limitations

* Currently only the Ktor Http Client is supported. Additional clients (e.g. Spring WebClient) might be supported in the future. If you have a suggestion, open an issue.
* Due to the custom logic required for deserialization of polymorphic types and default enum values only Jackson is currently supported.
* Only a single operation per query file is supported.
* Subscriptions are currently not supported.
* You cannot make multiple selections to the same GraphQL object in a single GraphQL query. However, you can have different selection sets across different GraphQL queries.
* Anonymous operations are supported but will result in a generic `AnonymousQuery` (for query operation) class. Plugins
do not keep track of state across different query generations so if you have multiple anonymous operations in a single
package your compilation will fail due to the generic class name collisions.

## Documentation

Additional information can be found in our [documentation](https://expediagroup.github.io/graphql-kotlin) and the
[Javadocs](https://www.javadoc.io/doc/com.expediagroup/graphql-kotlin-client) of all published versions.

If you have a question about something you can not find in our documentation or Javadocs, feel free to
[create an issue](https://github.com/ExpediaGroup/graphql-kotlin/issues) and tag it with the question label.
